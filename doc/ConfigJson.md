## Конфигурационный файл (config.json)

В Департаменте вычислительной биологии, который отвечает за разработку MoniQue, приняты следующие соглашения на параметры для запуска приложений:
  1. все параметры сборки или запуска воркера/приложения должны приниматься из файла config.json;
  2. файл config.json должен храниться в корне репозитория конкретного воркера/приложения;
  3. формат файла состоит из четко определенных подсекций;
  4. единственным необязательным параметром командной строки компонента/приложения может быть путь к конфиг файлу: `./app --config-file=/path/to/config.json` или  `./app -f /path/to/config.json`;
  5. по умолчанию файл берется из директории запуска воркера/приложения
  6. все секции необязательны, в конфиге можно оставлять только те секции, которые используются в конкретном воркере/приложении/библиотеке. Основных секций в файле две - build и deploy;
    * `build` - в секции build указывается дополнительная информация, необходимая для прохождения сборки. А именно: внешние зависимости в системе (libzmq, libgmp, или питоновские numpy, scipy и проч.) и тесты, если они необходимы и находятся во внешних репозиториях;
    * `deploy` - в секции deploy указывается все, что будет использоваться в работе: доступы к базам, пути к внешним API, очередям, необходимые для работы каталоги или файлы в файловой системе и прочее;
    * `params` - прочие параметры, не участвующие в сборке и деплое приложения, но, по усмотрению разработчика, необходимые для работы. Структура этой секции определяется тем сервисом или компонентом, который использует данный конфигурационный файл.

Основным читателем файла config.json будет робот CI/CD, который, во-первых, будет видеть, что необходимо для приложения, и, во-вторых, проставлять значения в зависимости от известного ему окружения, в котором он (робот) будет собирать или запускать приложение.

Данный подход позволяет единообразно подходить как разработке приложений, так и к организации их CI/CD.
От разработчиков компонентов требуется придерживаться данных правил.

### Одно место (Scheduler)

Конфигурационный файл для одного места выглядит следующим образом:

```
{ "build":{
    "deps":[
      "libzmq5",
      "libgmp10",
      "netbase"
    ]
  },
  "deploy":{
      "monique":{
          "scheduler-in" : {
              "host": "*",
              "comport": 9000,
              "techport": 9024
          },
          "scheduler-in-logic" : {
              "host": "localhost",
              "comport": 9010,
              "techport": 9034
          },
          "scheduler-logic-out" : {
              "host": "localhost",
              "comport": 9011,
              "techport": 9035
          },
          "scheduler-out" : {
              "host": "*",
              "comport": 9001,
              "techport": 9025
          }
    }
  },
    "params":{
        "scheduler-logic": {
            "allow-messages": [] 
        }
    }
}
```

Значение всех полей было описано в разделе "Одно место".
Здесь мы только остановимся на том, что `host` в `scheduler-in` и `scheduler-out` указаны как `*`.
Звёздочка в данном месте значит то, что SchedulerIn и SchedulerOut не знают заранее о том, с какого хоста к ним придёт сообщение или куда его нужно отправлять.
То есть `*` как бы говорит нам о том, что Scheduler ожидает сообщение ото всех и отправляет его тоже всем.

### Компонент

Теперь обратимся к тому, как должен выглядеть конфигурационный файл компонента:

```
{ "build":{
    "deps":[
      "libzmq5",
      "libgmp10",
      "netbase"
    ]
  },
  "deploy":{
    "monique":{
      "scheduler-in":{
        "host":"127.0.0.1",
        "comport":9000,
        "techport":9024
      },
      "scheduler-out":{
        "host":"127.0.0.1",
        "comport":9001,
        "techport":9025
      }
    }
  },
  "params":{
    "<project_component>":{
      "creator":"0000-0000-0000-<project_component>",
      "logfile":"/tmp/<project_component>.log",
      "frequency":60000,
      "controller":{
        "host":"",
        "port":""
      }
    }
  }
}
```

Сначала поясним часть `deploy`.
Как видно, вместо `*` в поле `host` теперь стоит конкретный хост (в примере это `127.0.0.1`).
Это потому, что компоненту нужно точно знать, где искать Scheduler.
Настройки компонента по портам такие же, как и у Scheduler.

Теперь перейдём к части `params`.
Поле `<project_component>`, которое является именем компонента, должно быть в формате `project_component`, где `project` и `component` могут содержать следующие символы: **маленькие** латинские буквы `a-z`, цифры `0-9`, дефис `-`.
Данный формат схож с форматом поля `spec`.
Имя компонента задаёт следующее:
  * часть имени файла логирования, в который будет писать компонент при работе;
  * поле `name` в техническом сообщении `monitoring` (читай раздел "Коммуникационный слой и технический слой");

Остальные поля обозначают:
  * `creator` - идентификатор сообщения. После появления системы авторизации, которая сможет авторизовывать кроме пользователей в том числе и системы, данное поле будет сделано разумным. А пока в него пишется какой-либо идентификатор;
  * `logfile` - путь до файла с логированием;
  * `frequency` - частота посылки сообщения с мониторингом в систему (читай раздел "Коммуникационный слой и технический слой") в **миллисекундах**, по умолчанию предлагается выставлять его равным одной минуте;
  * `controller` - если данный компонент получает сообщения из очереди посредством контроллера (читай раздел "Контроллер"), то данное поле задаёт порт и хост, на котором искать соответствующий контроллер.
  

